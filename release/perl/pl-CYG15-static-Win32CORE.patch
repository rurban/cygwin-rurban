difforig perl-current/ext/Win32CORE/Makefile.PL

diff -u perl-current/ext/Win32CORE/Makefile.PL.orig perl-current/ext/Win32CORE/Makefile.PL
--- perl-current/ext/Win32CORE/Makefile.PL.orig	2008-12-19 09:13:57.000000000 +0000
+++ perl-current/ext/Win32CORE/Makefile.PL	2009-03-24 16:46:59.207875000 +0000
@@ -12,7 +12,22 @@
   return '' unless $self->needs_linking();
   my $base = $self->SUPER::cflags($libperl);
   if ($self->{LINKTYPE} eq 'static') {
-    $base =~ s/CCFLAGS =(.*)$/CCFLAGS =\1 -UUSEIMPORTLIB /m;
+    $base =~ s/-DUSEIMPORTLIB/-UUSEIMPORTLIB/mg;
   }
   return $base;
 }
+
+sub MY::static {
+  package MY;         # so that "SUPER" works right
+  my $self = shift;
+  return $self->SUPER::static(@_) unless $^O eq 'cygwin';
+  '
+# cygwin with libtool cannot link this as .a, required for mod_perl e.g.
+# So we add it directly to libperl.
+$(PERL_SRC)/$(OBJECT) : $(FIRST_MAKEFILE) $(OBJECT)
+	$(RM_RF) $(PERL_SRC)/$(OBJECT)
+	$(CP) $(OBJECT) $(PERL_SRC)/$(OBJECT)
+
+static :: $(FIRST_MAKEFILE) $(PERL_SRC)/$(OBJECT) $(INST_STATIC)
+';
+}
