difforig perl-5.10.1/hints/cygwin.sh

diff -u perl-5.10.1/hints/cygwin.sh.orig perl-5.10.1/hints/cygwin.sh
--- perl-5.10.1/hints/cygwin.sh.orig	2009-04-19 23:13:05.000000000 +0000
+++ perl-5.10.1/hints/cygwin.sh	2009-08-30 09:04:11.343750000 +0000
@@ -30,30 +30,41 @@
 #   the Perl SysV IPC tests so not adding it --jhi 2003-08-09
 #   (with cygwin 1.5.7, cygipc is deprecated in favor of the builtin cygserver)
 libswanted="$libswanted gdbm_compat"
-test -z "$optimize" && optimize='-O3'
+test -z "$optimize" && optimize='-O3'
 man3ext='3pm'
 test -z "$use64bitint" && use64bitint='define'
 test -z "$usethreads" && usethreads='define'
 test -z "$usemymalloc" && usemymalloc='define'
 ccflags="$ccflags -DPERL_USE_SAFE_PUTENV -U__STRICT_ANSI__"
-# - otherwise i686-cygwin
-archname='cygwin'
+# i686-cygwin
+archname='i686-cygwin'
 
 # dynamic loading
 # - otherwise -fpic
 cccdlflags=' '
 lddlflags=' --shared'
-ld='g++'
+test -z "$ld" && ld='g++'
 
 case "$osvers" in
-
-# Configure gets these wrong if the IPC server isn't yet running:
-# only use for 1.5.7 and onwards
-[2-9]*|1.[6-9]*|1.[1-5][0-9]*|1.5.[7-9]*|1.5.[1-6][0-9]*)
+    # Configure gets these wrong if the IPC server isn't yet running:
+    # only use for 1.5.7 and onwards
+    [2-9]*|1.[6-9]*|1.[1-5][0-9]*|1.5.[7-9]*|1.5.[1-6][0-9]*)
         d_semctl_semid_ds='define'
         d_semctl_semun='define'
         ;;
-esac;
+esac
+
+case "$osvers" in
+    [2-9]*|1.[6-9]*)
+        # IPv6 only since 1.7
+        d_inetntop='define'
+        d_inetpton='define'
+        ;;
+    *)
+        # IPv6 not implemented before cygwin-1.7
+        d_inetntop='undef'
+        d_inetpton='undef'
+esac
 
 # compile Win32CORE "module" as static. try to avoid the space.
 if test -z "$static_ext"; then
@@ -73,7 +84,3 @@
 #ldflags="$ldflags -s"
 #ccdlflags="$ccdlflags -s"
 #lddlflags="$lddlflags -s"
-
-# IPv6 not fully implemented under Cygwin
-d_inetntop='undef'
-d_inetpton='undef'
